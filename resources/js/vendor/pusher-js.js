var e=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:global;var t={};(function webpackUniversalModuleDefinition(e,n){t=n()})(window,(function(){return function(e){var t={};function __webpack_require__(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:false,exports:{}};e[n].call(r.exports,r,r.exports,__webpack_require__);r.l=true;return r.exports}__webpack_require__.m=e;__webpack_require__.c=t;__webpack_require__.d=function(e,t,n){__webpack_require__.o(e,t)||Object.defineProperty(e,t,{enumerable:true,get:n})};__webpack_require__.r=function(e){typeof Symbol!=="undefined"&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"});Object.defineProperty(e,"__esModule",{value:true})};__webpack_require__.t=function(e,t){t&1&&(e=__webpack_require__(e));if(t&8)return e;if(t&4&&typeof e==="object"&&e&&e.__esModule)return e;var n=Object.create(null);__webpack_require__.r(n);Object.defineProperty(n,"default",{enumerable:true,value:e});if(t&2&&typeof e!="string")for(var r in e)__webpack_require__.d(n,r,function(t){return e[t]}.bind(null,r));return n};__webpack_require__.n=function(e){var t=e&&e.__esModule?function getDefault(){return e.default}:function getModuleExports(){return e};__webpack_require__.d(t,"a",t);return t};__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=2)}([function(t,n,r){var i=(this||e)&&(this||e).__extends||function(){var extendStatics=function(e,t){extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return extendStatics(e,t)};return function(t,n){extendStatics(t,n);function __(){(this||e).constructor=t}t.prototype=n===null?Object.create(n):(__.prototype=n.prototype,new __)}}();Object.defineProperty(n,"__esModule",{value:true});var s=256;var o=function(){function Coder(t){t===void 0&&(t="=");(this||e)._paddingCharacter=t}Coder.prototype.encodedLength=function(t){return(this||e)._paddingCharacter?(t+2)/3*4|0:(t*8+5)/6|0};Coder.prototype.encode=function(t){var n="";var r=0;for(;r<t.length-2;r+=3){var i=t[r]<<16|t[r+1]<<8|t[r+2];n+=this._encodeByte(i>>>18&63);n+=this._encodeByte(i>>>12&63);n+=this._encodeByte(i>>>6&63);n+=this._encodeByte(i>>>0&63)}var s=t.length-r;if(s>0){i=t[r]<<16|(s===2?t[r+1]<<8:0);n+=this._encodeByte(i>>>18&63);n+=this._encodeByte(i>>>12&63);n+=s===2?this._encodeByte(i>>>6&63):(this||e)._paddingCharacter||"";n+=(this||e)._paddingCharacter||""}return n};Coder.prototype.maxDecodedLength=function(t){return(this||e)._paddingCharacter?t/4*3|0:(t*6+7)/8|0};Coder.prototype.decodedLength=function(e){return this.maxDecodedLength(e.length-this._getPaddingLength(e))};Coder.prototype.decode=function(e){if(e.length===0)return new Uint8Array(0);var t=this._getPaddingLength(e);var n=e.length-t;var r=new Uint8Array(this.maxDecodedLength(n));var i=0;var o=0;var a=0;var c=0,h=0,u=0,l=0;for(;o<n-4;o+=4){c=this._decodeChar(e.charCodeAt(o+0));h=this._decodeChar(e.charCodeAt(o+1));u=this._decodeChar(e.charCodeAt(o+2));l=this._decodeChar(e.charCodeAt(o+3));r[i++]=c<<2|h>>>4;r[i++]=h<<4|u>>>2;r[i++]=u<<6|l;a|=c&s;a|=h&s;a|=u&s;a|=l&s}if(o<n-1){c=this._decodeChar(e.charCodeAt(o));h=this._decodeChar(e.charCodeAt(o+1));r[i++]=c<<2|h>>>4;a|=c&s;a|=h&s}if(o<n-2){u=this._decodeChar(e.charCodeAt(o+2));r[i++]=h<<4|u>>>2;a|=u&s}if(o<n-3){l=this._decodeChar(e.charCodeAt(o+3));r[i++]=u<<6|l;a|=l&s}if(a!==0)throw new Error("Base64Coder: incorrect characters for decoding");return r};Coder.prototype._encodeByte=function(e){var t=e;t+=65;t+=25-e>>>8&6;t+=51-e>>>8&-75;t+=61-e>>>8&-15;t+=62-e>>>8&3;return String.fromCharCode(t)};Coder.prototype._decodeChar=function(e){var t=s;t+=(42-e&e-44)>>>8&-s+e-43+62;t+=(46-e&e-48)>>>8&-s+e-47+63;t+=(47-e&e-58)>>>8&-s+e-48+52;t+=(64-e&e-91)>>>8&-s+e-65+0;t+=(96-e&e-123)>>>8&-s+e-97+26;return t};Coder.prototype._getPaddingLength=function(t){var n=0;if((this||e)._paddingCharacter){for(var r=t.length-1;r>=0;r--){if(t[r]!==(this||e)._paddingCharacter)break;n++}if(t.length<4||n>2)throw new Error("Base64Coder: incorrect padding")}return n};return Coder}();n.Coder=o;var a=new o;function encode(e){return a.encode(e)}n.encode=encode;function decode(e){return a.decode(e)}n.decode=decode;var c=function(t){i(URLSafeCoder,t);function URLSafeCoder(){return t!==null&&t.apply(this||e,arguments)||this||e}URLSafeCoder.prototype._encodeByte=function(e){var t=e;t+=65;t+=25-e>>>8&6;t+=51-e>>>8&-75;t+=61-e>>>8&-13;t+=62-e>>>8&49;return String.fromCharCode(t)};URLSafeCoder.prototype._decodeChar=function(e){var t=s;t+=(44-e&e-46)>>>8&-s+e-45+62;t+=(94-e&e-96)>>>8&-s+e-95+63;t+=(47-e&e-58)>>>8&-s+e-48+52;t+=(64-e&e-91)>>>8&-s+e-65+0;t+=(96-e&e-123)>>>8&-s+e-97+26;return t};return URLSafeCoder}(o);n.URLSafeCoder=c;var h=new c;function encodeURLSafe(e){return h.encode(e)}n.encodeURLSafe=encodeURLSafe;function decodeURLSafe(e){return h.decode(e)}n.decodeURLSafe=decodeURLSafe;n.encodedLength=function(e){return a.encodedLength(e)};n.maxDecodedLength=function(e){return a.maxDecodedLength(e)};n.decodedLength=function(e){return a.decodedLength(e)}},function(e,t,n){Object.defineProperty(t,"__esModule",{value:true});var r="utf8: invalid string";var i="utf8: invalid source encoding";function encode(e){var t=new Uint8Array(encodedLength(e));var n=0;for(var r=0;r<e.length;r++){var i=e.charCodeAt(r);if(i<128)t[n++]=i;else if(i<2048){t[n++]=192|i>>6;t[n++]=128|i&63}else if(i<55296){t[n++]=224|i>>12;t[n++]=128|i>>6&63;t[n++]=128|i&63}else{r++;i=(i&1023)<<10;i|=e.charCodeAt(r)&1023;i+=65536;t[n++]=240|i>>18;t[n++]=128|i>>12&63;t[n++]=128|i>>6&63;t[n++]=128|i&63}}return t}t.encode=encode;function encodedLength(e){var t=0;for(var n=0;n<e.length;n++){var i=e.charCodeAt(n);if(i<128)t+=1;else if(i<2048)t+=2;else if(i<55296)t+=3;else{if(!(i<=57343))throw new Error(r);if(n>=e.length-1)throw new Error(r);n++;t+=4}}return t}t.encodedLength=encodedLength;function decode(e){var t=[];for(var n=0;n<e.length;n++){var r=e[n];if(r&128){var s=void 0;if(r<224){if(n>=e.length)throw new Error(i);var o=e[++n];if((o&192)!==128)throw new Error(i);r=(r&31)<<6|o&63;s=128}else if(r<240){if(n>=e.length-1)throw new Error(i);o=e[++n];var a=e[++n];if((o&192)!==128||(a&192)!==128)throw new Error(i);r=(r&15)<<12|(o&63)<<6|a&63;s=2048}else{if(!(r<248))throw new Error(i);if(n>=e.length-2)throw new Error(i);o=e[++n];a=e[++n];var c=e[++n];if((o&192)!==128||(a&192)!==128||(c&192)!==128)throw new Error(i);r=(r&15)<<18|(o&63)<<12|(a&63)<<6|c&63;s=65536}if(r<s||r>=55296&&r<=57343)throw new Error(i);if(r>=65536){if(r>1114111)throw new Error(i);r-=65536;t.push(String.fromCharCode(55296|r>>10));r=56320|r&1023}}t.push(String.fromCharCode(r))}return t.join("")}t.decode=decode},function(e,t,n){e.exports=n(3).default},function(t,n,r){r.r(n);class ScriptReceiverFactory{constructor(e,t){this.lastId=0;this.prefix=e;this.name=t}create(e){this.lastId++;var t=this.lastId;var n=this.prefix+t;var r=this.name+"["+t+"]";var i=false;var callbackWrapper=function(){if(!i){e.apply(null,arguments);i=true}};this[t]=callbackWrapper;return{number:t,id:n,name:r,callback:callbackWrapper}}remove(e){delete this[e.number]}}var i=new ScriptReceiverFactory("_pusher_script_","Pusher.ScriptReceivers");var s={VERSION:"8.4.0-rc2",PROTOCOL:7,wsPort:80,wssPort:443,wsPath:"",httpHost:"sockjs.pusher.com",httpPort:80,httpsPort:443,httpPath:"/pusher",stats_host:"stats.pusher.com",authEndpoint:"/pusher/auth",authTransport:"ajax",activityTimeout:12e4,pongTimeout:3e4,unavailableTimeout:1e4,userAuthentication:{endpoint:"/pusher/user-auth",transport:"ajax"},channelAuthorization:{endpoint:"/pusher/auth",transport:"ajax"},cdn_http:"http://js.pusher.com",cdn_https:"https://js.pusher.com",dependency_suffix:""};var o=s;class dependency_loader_DependencyLoader{constructor(e){this.options=e;this.receivers=e.receivers||i;this.loading={}}load(e,t,n){var r=this;if(r.loading[e]&&r.loading[e].length>0)r.loading[e].push(n);else{r.loading[e]=[n];var i=ge.createScriptRequest(r.getPath(e,t));var s=r.receivers.create((function(t){r.receivers.remove(s);if(r.loading[e]){var n=r.loading[e];delete r.loading[e];var successCallback=function(e){e||i.cleanup()};for(var o=0;o<n.length;o++)n[o](t,successCallback)}}));i.send(s)}}getRoot(e){var t;var n=ge.getDocument().location.protocol;t=e&&e.useTLS||n==="https:"?this.options.cdn_https:this.options.cdn_http;return t.replace(/\/*$/,"")+"/"+this.options.version}getPath(e,t){return this.getRoot(t)+"/"+e+this.options.suffix+".js"}}var a=new ScriptReceiverFactory("_pusher_dependencies","Pusher.DependenciesReceivers");var c=new dependency_loader_DependencyLoader({cdn_http:o.cdn_http,cdn_https:o.cdn_https,version:o.VERSION,suffix:o.dependency_suffix,receivers:a});const h={baseUrl:"https://pusher.com",urls:{authenticationEndpoint:{path:"/docs/channels/server_api/authenticating_users"},authorizationEndpoint:{path:"/docs/channels/server_api/authorizing-users/"},javascriptQuickStart:{path:"/docs/javascript_quick_start"},triggeringClientEvents:{path:"/docs/client_api_guide/client_events#trigger-events"},encryptedChannelSupport:{fullUrl:"https://github.com/pusher/pusher-js/tree/cc491015371a4bde5743d1c87a0fbac0feb53195#encrypted-channel-support"}}};const buildLogSuffix=function(e){const t="See:";const n=h.urls[e];if(!n)return"";let r;n.fullUrl?r=n.fullUrl:n.path&&(r=h.baseUrl+n.path);return r?`${t} ${r}`:""};var u={buildLogSuffix:buildLogSuffix};var l;(function(e){e.UserAuthentication="user-authentication";e.ChannelAuthorization="channel-authorization"})(l||(l={}));class BadEventName extends Error{constructor(e){super(e);Object.setPrototypeOf(this,new.target.prototype)}}class BadChannelName extends Error{constructor(e){super(e);Object.setPrototypeOf(this,new.target.prototype)}}class RequestTimedOut extends Error{constructor(e){super(e);Object.setPrototypeOf(this,new.target.prototype)}}class TransportPriorityTooLow extends Error{constructor(e){super(e);Object.setPrototypeOf(this,new.target.prototype)}}class TransportClosed extends Error{constructor(e){super(e);Object.setPrototypeOf(this,new.target.prototype)}}class UnsupportedFeature extends Error{constructor(e){super(e);Object.setPrototypeOf(this,new.target.prototype)}}class UnsupportedTransport extends Error{constructor(e){super(e);Object.setPrototypeOf(this,new.target.prototype)}}class UnsupportedStrategy extends Error{constructor(e){super(e);Object.setPrototypeOf(this,new.target.prototype)}}class HTTPAuthError extends Error{constructor(e,t){super(t);this.status=e;Object.setPrototypeOf(this,new.target.prototype)}}const ajax=function(e,t,n,r,i){const s=ge.createXHR();s.open("POST",n.endpoint,true);s.setRequestHeader("Content-Type","application/x-www-form-urlencoded");for(var o in n.headers)s.setRequestHeader(o,n.headers[o]);if(n.headersProvider!=null){let e=n.headersProvider();for(var o in e)s.setRequestHeader(o,e[o])}s.onreadystatechange=function(){if(s.readyState===4)if(s.status===200){let e;let t=false;try{e=JSON.parse(s.responseText);t=true}catch(e){i(new HTTPAuthError(200,`JSON returned from ${r.toString()} endpoint was invalid, yet status code was 200. Data was: ${s.responseText}`),null)}t&&i(null,e)}else{let e="";switch(r){case l.UserAuthentication:e=u.buildLogSuffix("authenticationEndpoint");break;case l.ChannelAuthorization:e=`Clients must be authorized to join private or presence channels. ${u.buildLogSuffix("authorizationEndpoint")}`;break}i(new HTTPAuthError(s.status,`Unable to retrieve auth string from ${r.toString()} endpoint - received status: ${s.status} from ${n.endpoint}. ${e}`),null)}};s.send(t);return s};var d=ajax;function encode(e){return m(utob(e))}var p=String.fromCharCode;var f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";var g={};for(var v=0,b=f.length;v<b;v++)g[f.charAt(v)]=v;var cb_utob=function(e){var t=e.charCodeAt(0);return t<128?e:t<2048?p(192|t>>>6)+p(128|t&63):p(224|t>>>12&15)+p(128|t>>>6&63)+p(128|t&63)};var utob=function(e){return e.replace(/[^\x00-\x7F]/g,cb_utob)};var cb_encode=function(e){var t=[0,2,1][e.length%3];var n=e.charCodeAt(0)<<16|(e.length>1?e.charCodeAt(1):0)<<8|(e.length>2?e.charCodeAt(2):0);var r=[f.charAt(n>>>18),f.charAt(n>>>12&63),t>=2?"=":f.charAt(n>>>6&63),t>=1?"=":f.charAt(n&63)];return r.join("")};var m=window.btoa||function(e){return e.replace(/[\s\S]{1,3}/g,cb_encode)};class Timer{constructor(e,t,n,r){this.clear=t;this.timer=e((()=>{this.timer&&(this.timer=r(this.timer))}),n)}isRunning(){return this.timer!==null}ensureAborted(){if(this.timer){this.clear(this.timer);this.timer=null}}}var _=Timer;function timers_clearTimeout(e){window.clearTimeout(e)}function timers_clearInterval(e){window.clearInterval(e)}class timers_OneOffTimer extends _{constructor(e,t){super(setTimeout,timers_clearTimeout,e,(function(e){t();return null}))}}class timers_PeriodicTimer extends _{constructor(e,t){super(setInterval,timers_clearInterval,e,(function(e){t();return e}))}}var y={now(){return Date.now?Date.now():(new Date).valueOf()},defer(e){return new timers_OneOffTimer(0,e)},method(e,...t){var n=Array.prototype.slice.call(arguments,1);return function(t){return t[e].apply(t,n.concat(arguments))}}};var S=y;function extend(e,...t){for(var n=0;n<t.length;n++){var r=t[n];for(var i in r)r[i]&&r[i].constructor&&r[i].constructor===Object?e[i]=extend(e[i]||{},r[i]):e[i]=r[i]}return e}function stringify(){var e=["Pusher"];for(var t=0;t<arguments.length;t++)typeof arguments[t]==="string"?e.push(arguments[t]):e.push(safeJSONStringify(arguments[t]));return e.join(" : ")}function arrayIndexOf(e,t){var n=Array.prototype.indexOf;if(e===null)return-1;if(n&&e.indexOf===n)return e.indexOf(t);for(var r=0,i=e.length;r<i;r++)if(e[r]===t)return r;return-1}function objectApply(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(e[n],n,e)}function keys(e){var t=[];objectApply(e,(function(e,n){t.push(n)}));return t}function values(e){var t=[];objectApply(e,(function(e){t.push(e)}));return t}function apply(e,t,n){for(var r=0;r<e.length;r++)t.call(n||window,e[r],r,e)}function map(e,t){var n=[];for(var r=0;r<e.length;r++)n.push(t(e[r],r,e,n));return n}function mapObject(e,t){var n={};objectApply(e,(function(e,r){n[r]=t(e)}));return n}function filter(e,t){t=t||function(e){return!!e};var n=[];for(var r=0;r<e.length;r++)t(e[r],r,e,n)&&n.push(e[r]);return n}function filterObject(e,t){var n={};objectApply(e,(function(r,i){(t&&t(r,i,e,n)||Boolean(r))&&(n[i]=r)}));return n}function flatten(e){var t=[];objectApply(e,(function(e,n){t.push([n,e])}));return t}function any(e,t){for(var n=0;n<e.length;n++)if(t(e[n],n,e))return true;return false}function collections_all(e,t){for(var n=0;n<e.length;n++)if(!t(e[n],n,e))return false;return true}function encodeParamsObject(e){return mapObject(e,(function(e){typeof e==="object"&&(e=safeJSONStringify(e));return encodeURIComponent(encode(e.toString()))}))}function buildQueryString(e){var t=filterObject(e,(function(e){return e!==void 0}));var n=map(flatten(encodeParamsObject(t)),S.method("join","=")).join("&");return n}function decycleObject(e){var t=[],n=[];return function derez(e,r){var i,s,o;switch(typeof e){case"object":if(!e)return null;for(i=0;i<t.length;i+=1)if(t[i]===e)return{$ref:n[i]};t.push(e);n.push(r);if(Object.prototype.toString.apply(e)==="[object Array]"){o=[];for(i=0;i<e.length;i+=1)o[i]=derez(e[i],r+"["+i+"]")}else{o={};for(s in e)Object.prototype.hasOwnProperty.call(e,s)&&(o[s]=derez(e[s],r+"["+JSON.stringify(s)+"]"))}return o;case"number":case"string":case"boolean":return e}}(e,"$")}function safeJSONStringify(e){try{return JSON.stringify(e)}catch(t){return JSON.stringify(decycleObject(e))}}class logger_Logger{constructor(){this.globalLog=e=>{window.console&&window.console.log&&window.console.log(e)}}debug(...e){this.log(this.globalLog,e)}warn(...e){this.log(this.globalLogWarn,e)}error(...e){this.log(this.globalLogError,e)}globalLogWarn(e){window.console&&window.console.warn?window.console.warn(e):this.globalLog(e)}globalLogError(e){window.console&&window.console.error?window.console.error(e):this.globalLogWarn(e)}log(e,...t){var n=stringify.apply(this,arguments);if(Ce.log)Ce.log(n);else if(Ce.logToConsole){const t=e.bind(this);t(n)}}}var w=new logger_Logger;var jsonp=function(e,t,n,r,i){n.headers===void 0&&n.headersProvider==null||w.warn(`To send headers with the ${r.toString()} request, you must use AJAX, rather than JSONP.`);var s=e.nextAuthCallbackID.toString();e.nextAuthCallbackID++;var o=e.getDocument();var a=o.createElement("script");e.auth_callbacks[s]=function(e){i(null,e)};var c="Pusher.auth_callbacks['"+s+"']";a.src=n.endpoint+"?callback="+encodeURIComponent(c)+"&"+t;var h=o.getElementsByTagName("head")[0]||o.documentElement;h.insertBefore(a,h.firstChild)};var C=jsonp;class ScriptRequest{constructor(e){this.src=e}send(e){var t=this;var n="Error loading "+t.src;t.script=document.createElement("script");t.script.id=e.id;t.script.src=t.src;t.script.type="text/javascript";t.script.charset="UTF-8";if(t.script.addEventListener){t.script.onerror=function(){e.callback(n)};t.script.onload=function(){e.callback(null)}}else t.script.onreadystatechange=function(){t.script.readyState!=="loaded"&&t.script.readyState!=="complete"||e.callback(null)};if(t.script.async===void 0&&document.attachEvent&&/opera/i.test(navigator.userAgent)){t.errorScript=document.createElement("script");t.errorScript.id=e.id+"_error";t.errorScript.text=e.name+"('"+n+"');";t.script.async=t.errorScript.async=false}else t.script.async=true;var r=document.getElementsByTagName("head")[0];r.insertBefore(t.script,r.firstChild);t.errorScript&&r.insertBefore(t.errorScript,t.script.nextSibling)}cleanup(){if(this.script){this.script.onload=this.script.onerror=null;this.script.onreadystatechange=null}this.script&&this.script.parentNode&&this.script.parentNode.removeChild(this.script);this.errorScript&&this.errorScript.parentNode&&this.errorScript.parentNode.removeChild(this.errorScript);this.script=null;this.errorScript=null}}class jsonp_request_JSONPRequest{constructor(e,t){this.url=e;this.data=t}send(e){if(!this.request){var t=buildQueryString(this.data);var n=this.url+"/"+e.number+"?"+t;this.request=ge.createScriptRequest(n);this.request.send(e)}}cleanup(){this.request&&this.request.cleanup()}}var getAgent=function(e,t){return function(n,r){var s="http"+(t?"s":"")+"://";var o=s+(e.host||e.options.host)+e.options.path;var a=ge.createJSONPRequest(o,n);var c=ge.ScriptReceivers.create((function(t,n){i.remove(c);a.cleanup();n&&n.host&&(e.host=n.host);r&&r(t,n)}));a.send(c)}};var k={name:"jsonp",getAgent:getAgent};var T=k;function getGenericURL(e,t,n){var r=e+(t.useTLS?"s":"");var i=t.useTLS?t.hostTLS:t.hostNonTLS;return r+"://"+i+n}function getGenericPath(e,t){var n="/app/"+e;var r="?protocol="+o.PROTOCOL+"&client=js&version="+o.VERSION+(t?"&"+t:"");return n+r}var P={getInitial:function(e,t){var n=(t.httpPath||"")+getGenericPath(e,"flash=false");return getGenericURL("ws",t,n)}};var O={getInitial:function(e,t){var n=(t.httpPath||"/pusher")+getGenericPath(e);return getGenericURL("http",t,n)}};var x={getInitial:function(e,t){return getGenericURL("http",t,t.httpPath||"/pusher")},getPath:function(e,t){return getGenericPath(e)}};class callback_registry_CallbackRegistry{constructor(){this._callbacks={}}get(e){return this._callbacks[prefix(e)]}add(e,t,n){var r=prefix(e);this._callbacks[r]=this._callbacks[r]||[];this._callbacks[r].push({fn:t,context:n})}remove(e,t,n){if(e||t||n){var r=e?[prefix(e)]:keys(this._callbacks);t||n?this.removeCallback(r,t,n):this.removeAllCallbacks(r)}else this._callbacks={}}removeCallback(e,t,n){apply(e,(function(e){this._callbacks[e]=filter(this._callbacks[e]||[],(function(e){return t&&t!==e.fn||n&&n!==e.context}));this._callbacks[e].length===0&&delete this._callbacks[e]}),this)}removeAllCallbacks(e){apply(e,(function(e){delete this._callbacks[e]}),this)}}function prefix(e){return"_"+e}class dispatcher_Dispatcher{constructor(e){this.callbacks=new callback_registry_CallbackRegistry;this.global_callbacks=[];this.failThrough=e}bind(e,t,n){this.callbacks.add(e,t,n);return this}bind_global(e){this.global_callbacks.push(e);return this}unbind(e,t,n){this.callbacks.remove(e,t,n);return this}unbind_global(e){if(!e){this.global_callbacks=[];return this}this.global_callbacks=filter(this.global_callbacks||[],(t=>t!==e));return this}unbind_all(){this.unbind();this.unbind_global();return this}emit(e,t,n){for(var r=0;r<this.global_callbacks.length;r++)this.global_callbacks[r](e,t);var i=this.callbacks.get(e);var s=[];n?s.push(t,n):t&&s.push(t);if(i&&i.length>0)for(r=0;r<i.length;r++)i[r].fn.apply(i[r].context||window,s);else this.failThrough&&this.failThrough(e,t);return this}}class transport_connection_TransportConnection extends dispatcher_Dispatcher{constructor(e,t,n,r,i){super();this.initialize=ge.transportConnectionInitializer;this.hooks=e;this.name=t;this.priority=n;this.key=r;this.options=i;this.state="new";this.timeline=i.timeline;this.activityTimeout=i.activityTimeout;this.id=this.timeline.generateUniqueID()}handlesActivityChecks(){return Boolean(this.hooks.handlesActivityChecks)}supportsPing(){return Boolean(this.hooks.supportsPing)}connect(){if(this.socket||this.state!=="initialized")return false;var e=this.hooks.urls.getInitial(this.key,this.options);try{this.socket=this.hooks.getSocket(e,this.options)}catch(e){S.defer((()=>{this.onError(e);this.changeState("closed")}));return false}this.bindListeners();w.debug("Connecting",{transport:this.name,url:e});this.changeState("connecting");return true}close(){if(this.socket){this.socket.close();return true}return false}send(e){if(this.state==="open"){S.defer((()=>{this.socket&&this.socket.send(e)}));return true}return false}ping(){this.state==="open"&&this.supportsPing()&&this.socket.ping()}onOpen(){this.hooks.beforeOpen&&this.hooks.beforeOpen(this.socket,this.hooks.urls.getPath(this.key,this.options));this.changeState("open");this.socket.onopen=void 0}onError(e){this.emit("error",{type:"WebSocketError",error:e});this.timeline.error(this.buildTimelineMessage({error:e.toString()}))}onClose(e){e?this.changeState("closed",{code:e.code,reason:e.reason,wasClean:e.wasClean}):this.changeState("closed");this.unbindListeners();this.socket=void 0}onMessage(e){this.emit("message",e)}onActivity(){this.emit("activity")}bindListeners(){this.socket.onopen=()=>{this.onOpen()};this.socket.onerror=e=>{this.onError(e)};this.socket.onclose=e=>{this.onClose(e)};this.socket.onmessage=e=>{this.onMessage(e)};this.supportsPing()&&(this.socket.onactivity=()=>{this.onActivity()})}unbindListeners(){if(this.socket){this.socket.onopen=void 0;this.socket.onerror=void 0;this.socket.onclose=void 0;this.socket.onmessage=void 0;this.supportsPing()&&(this.socket.onactivity=void 0)}}changeState(e,t){this.state=e;this.timeline.info(this.buildTimelineMessage({state:e,params:t}));this.emit(e,t)}buildTimelineMessage(e){return extend({cid:this.id},e)}}class transport_Transport{constructor(e){this.hooks=e}isSupported(e){return this.hooks.isSupported(e)}createConnection(e,t,n,r){return new transport_connection_TransportConnection(this.hooks,e,t,n,r)}}var L=new transport_Transport({urls:P,handlesActivityChecks:false,supportsPing:false,isInitialized:function(){return Boolean(ge.getWebSocketAPI())},isSupported:function(){return Boolean(ge.getWebSocketAPI())},getSocket:function(e){return ge.createWebSocket(e)}});var E={urls:O,handlesActivityChecks:false,supportsPing:true,isInitialized:function(){return true}};var R=extend({getSocket:function(e){return ge.HTTPFactory.createStreamingSocket(e)}},E);var A=extend({getSocket:function(e){return ge.HTTPFactory.createPollingSocket(e)}},E);var I={isSupported:function(){return ge.isXHRSupported()}};var D=new transport_Transport(extend({},R,I));var j=new transport_Transport(extend({},A,I));var U={ws:L,xhr_streaming:D,xhr_polling:j};var q=U;var N=new transport_Transport({file:"sockjs",urls:x,handlesActivityChecks:true,supportsPing:false,isSupported:function(){return true},isInitialized:function(){return window.SockJS!==void 0},getSocket:function(e,t){return new window.SockJS(e,null,{js_path:c.getPath("sockjs",{useTLS:t.useTLS}),ignore_null_origin:t.ignoreNullOrigin})},beforeOpen:function(e,t){e.send(JSON.stringify({path:t}))}});var H={isSupported:function(e){var t=ge.isXDRSupported(e.useTLS);return t}};var M=new transport_Transport(extend({},R,H));var z=new transport_Transport(extend({},A,H));q.xdr_streaming=M;q.xdr_polling=z;q.sockjs=N;var B=q;class net_info_NetInfo extends dispatcher_Dispatcher{constructor(){super();var e=this;if(window.addEventListener!==void 0){window.addEventListener("online",(function(){e.emit("online")}),false);window.addEventListener("offline",(function(){e.emit("offline")}),false)}}isOnline(){return window.navigator.onLine===void 0||window.navigator.onLine}}var F=new net_info_NetInfo;class assistant_to_the_transport_manager_AssistantToTheTransportManager{constructor(e,t,n){this.manager=e;this.transport=t;this.minPingDelay=n.minPingDelay;this.maxPingDelay=n.maxPingDelay;this.pingDelay=void 0}createConnection(e,t,n,r){r=extend({},r,{activityTimeout:this.pingDelay});var i=this.transport.createConnection(e,t,n,r);var s=null;var onOpen=function(){i.unbind("open",onOpen);i.bind("closed",onClosed);s=S.now()};var onClosed=e=>{i.unbind("closed",onClosed);if(e.code===1002||e.code===1003)this.manager.reportDeath();else if(!e.wasClean&&s){var t=S.now()-s;if(t<2*this.maxPingDelay){this.manager.reportDeath();this.pingDelay=Math.max(t/2,this.minPingDelay)}}};i.bind("open",onOpen);return i}isSupported(e){return this.manager.isAlive()&&this.transport.isSupported(e)}}const J={decodeMessage:function(e){try{var t=JSON.parse(e.data);var n=t.data;if(typeof n==="string")try{n=JSON.parse(t.data)}catch(e){}var r={event:t.event,channel:t.channel,data:n};t.user_id&&(r.user_id=t.user_id);return r}catch(t){throw{type:"MessageParseError",error:t,data:e.data}}},encodeMessage:function(e){return JSON.stringify(e)},processHandshake:function(e){var t=J.decodeMessage(e);if(t.event==="pusher:connection_established"){if(!t.data.activity_timeout)throw"No activity timeout specified in handshake";return{action:"connected",id:t.data.socket_id,activityTimeout:t.data.activity_timeout*1e3}}if(t.event==="pusher:error")return{action:this.getCloseAction(t.data),error:this.getCloseError(t.data)};throw"Invalid handshake"},getCloseAction:function(e){return e.code<4e3?e.code>=1002&&e.code<=1004?"backoff":null:e.code===4e3?"tls_only":e.code<4100?"refused":e.code<4200?"backoff":e.code<4300?"retry":"refused"},getCloseError:function(e){return e.code!==1e3&&e.code!==1001?{type:"PusherError",data:{code:e.code,message:e.reason||e.message}}:null}};var $=J;class connection_Connection extends dispatcher_Dispatcher{constructor(e,t){super();this.id=e;this.transport=t;this.activityTimeout=t.activityTimeout;this.bindListeners()}handlesActivityChecks(){return this.transport.handlesActivityChecks()}send(e){return this.transport.send(e)}send_event(e,t,n){var r={event:e,data:t};n&&(r.channel=n);w.debug("Event sent",r);return this.send($.encodeMessage(r))}ping(){this.transport.supportsPing()?this.transport.ping():this.send_event("pusher:ping",{})}close(){this.transport.close()}bindListeners(){var e={message:e=>{var t;try{t=$.decodeMessage(e)}catch(t){this.emit("error",{type:"MessageParseError",error:t,data:e.data})}if(t!==void 0){w.debug("Event recd",t);switch(t.event){case"pusher:error":this.emit("error",{type:"PusherError",data:t.data});break;case"pusher:ping":this.emit("ping");break;case"pusher:pong":this.emit("pong");break}this.emit("message",t)}},activity:()=>{this.emit("activity")},error:e=>{this.emit("error",e)},closed:e=>{unbindListeners();e&&e.code&&this.handleCloseEvent(e);this.transport=null;this.emit("closed")}};var unbindListeners=()=>{objectApply(e,((e,t)=>{this.transport.unbind(t,e)}))};objectApply(e,((e,t)=>{this.transport.bind(t,e)}))}handleCloseEvent(e){var t=$.getCloseAction(e);var n=$.getCloseError(e);n&&this.emit("error",n);t&&this.emit(t,{action:t,error:n})}}class handshake_Handshake{constructor(e,t){this.transport=e;this.callback=t;this.bindListeners()}close(){this.unbindListeners();this.transport.close()}bindListeners(){this.onMessage=e=>{this.unbindListeners();var t;try{t=$.processHandshake(e)}catch(e){this.finish("error",{error:e});this.transport.close();return}if(t.action==="connected")this.finish("connected",{connection:new connection_Connection(t.id,this.transport),activityTimeout:t.activityTimeout});else{this.finish(t.action,{error:t.error});this.transport.close()}};this.onClosed=e=>{this.unbindListeners();var t=$.getCloseAction(e)||"backoff";var n=$.getCloseError(e);this.finish(t,{error:n})};this.transport.bind("message",this.onMessage);this.transport.bind("closed",this.onClosed)}unbindListeners(){this.transport.unbind("message",this.onMessage);this.transport.unbind("closed",this.onClosed)}finish(e,t){this.callback(extend({transport:this.transport,action:e},t))}}class timeline_sender_TimelineSender{constructor(e,t){this.timeline=e;this.options=t||{}}send(e,t){this.timeline.isEmpty()||this.timeline.send(ge.TimelineTransport.getAgent(this,e),t)}}class channel_Channel extends dispatcher_Dispatcher{constructor(e,t){super((function(t,n){w.debug("No callbacks on "+e+" for "+t)}));this.name=e;this.pusher=t;this.subscribed=false;this.subscriptionPending=false;this.subscriptionCancelled=false}authorize(e,t){return t(null,{auth:""})}trigger(e,t){if(e.indexOf("client-")!==0)throw new BadEventName("Event '"+e+"' does not start with 'client-'");if(!this.subscribed){var n=u.buildLogSuffix("triggeringClientEvents");w.warn(`Client event triggered before channel 'subscription_succeeded' event . ${n}`)}return this.pusher.send_event(e,t,this.name)}disconnect(){this.subscribed=false;this.subscriptionPending=false}handleEvent(e){var t=e.event;var n=e.data;if(t==="pusher_internal:subscription_succeeded")this.handleSubscriptionSucceededEvent(e);else if(t==="pusher_internal:subscription_count")this.handleSubscriptionCountEvent(e);else if(t.indexOf("pusher_internal:")!==0){var r={};this.emit(t,n,r)}}handleSubscriptionSucceededEvent(e){this.subscriptionPending=false;this.subscribed=true;this.subscriptionCancelled?this.pusher.unsubscribe(this.name):this.emit("pusher:subscription_succeeded",e.data)}handleSubscriptionCountEvent(e){e.data.subscription_count&&(this.subscriptionCount=e.data.subscription_count);this.emit("pusher:subscription_count",e.data)}subscribe(){if(!this.subscribed){this.subscriptionPending=true;this.subscriptionCancelled=false;this.authorize(this.pusher.connection.socket_id,((e,t)=>{if(e){this.subscriptionPending=false;w.error(e.toString());this.emit("pusher:subscription_error",Object.assign({},{type:"AuthError",error:e.message},e instanceof HTTPAuthError?{status:e.status}:{}))}else this.pusher.send_event("pusher:subscribe",{auth:t.auth,channel_data:t.channel_data,channel:this.name})}))}}unsubscribe(){this.subscribed=false;this.pusher.send_event("pusher:unsubscribe",{channel:this.name})}cancelSubscription(){this.subscriptionCancelled=true}reinstateSubscription(){this.subscriptionCancelled=false}}class private_channel_PrivateChannel extends channel_Channel{authorize(e,t){return this.pusher.config.channelAuthorizer({channelName:this.name,socketId:e},t)}}class members_Members{constructor(){this.reset()}get(e){return Object.prototype.hasOwnProperty.call(this.members,e)?{id:e,info:this.members[e]}:null}each(e){objectApply(this.members,((t,n)=>{e(this.get(n))}))}setMyID(e){this.myID=e}onSubscription(e){this.members=e.presence.hash;this.count=e.presence.count;this.me=this.get(this.myID)}addMember(e){this.get(e.user_id)===null&&this.count++;this.members[e.user_id]=e.user_info;return this.get(e.user_id)}removeMember(e){var t=this.get(e.user_id);if(t){delete this.members[e.user_id];this.count--}return t}reset(){this.members={};this.count=0;this.myID=null;this.me=null}}var X=(void 0,function(e,t,n,r){function adopt(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function fulfilled(e){try{step(r.next(e))}catch(e){i(e)}}function rejected(e){try{step(r.throw(e))}catch(e){i(e)}}function step(e){e.done?n(e.value):adopt(e.value).then(fulfilled,rejected)}step((r=r.apply(e,t||[])).next())}))});class presence_channel_PresenceChannel extends private_channel_PrivateChannel{constructor(e,t){super(e,t);this.members=new members_Members}authorize(e,t){super.authorize(e,((e,n)=>X(this,void 0,void 0,(function*(){if(!e){n;if(n.channel_data!=null){var r=JSON.parse(n.channel_data);this.members.setMyID(r.user_id)}else{yield this.pusher.user.signinDonePromise;if(this.pusher.user.user_data==null){let e=u.buildLogSuffix("authorizationEndpoint");w.error(`Invalid auth response for channel '${this.name}', expected 'channel_data' field. ${e}, or the user should be signed in.`);t("Invalid auth response");return}this.members.setMyID(this.pusher.user.user_data.id)}}t(e,n)}))))}handleEvent(e){var t=e.event;if(t.indexOf("pusher_internal:")===0)this.handleInternalEvent(e);else{var n=e.data;var r={};e.user_id&&(r.user_id=e.user_id);this.emit(t,n,r)}}handleInternalEvent(e){var t=e.event;var n=e.data;switch(t){case"pusher_internal:subscription_succeeded":this.handleSubscriptionSucceededEvent(e);break;case"pusher_internal:subscription_count":this.handleSubscriptionCountEvent(e);break;case"pusher_internal:member_added":var r=this.members.addMember(n);this.emit("pusher:member_added",r);break;case"pusher_internal:member_removed":var i=this.members.removeMember(n);i&&this.emit("pusher:member_removed",i);break}}handleSubscriptionSucceededEvent(e){this.subscriptionPending=false;this.subscribed=true;if(this.subscriptionCancelled)this.pusher.unsubscribe(this.name);else{this.members.onSubscription(e.data);this.emit("pusher:subscription_succeeded",this.members)}}disconnect(){this.members.reset();super.disconnect()}}var W=r(1);var G=r(0);class encrypted_channel_EncryptedChannel extends private_channel_PrivateChannel{constructor(e,t,n){super(e,t);this.key=null;this.nacl=n}authorize(e,t){super.authorize(e,((e,n)=>{if(e){t(e,n);return}let r=n.shared_secret;if(r){this.key=Object(G.decode)(r);delete n.shared_secret;t(null,n)}else t(new Error(`No shared_secret key in auth payload for encrypted channel: ${this.name}`),null)}))}trigger(e,t){throw new UnsupportedFeature("Client events are not currently supported for encrypted channels")}handleEvent(e){var t=e.event;var n=e.data;t.indexOf("pusher_internal:")!==0&&t.indexOf("pusher:")!==0?this.handleEncryptedEvent(t,n):super.handleEvent(e)}handleEncryptedEvent(e,t){if(!this.key){w.debug("Received encrypted event before key has been retrieved from the authEndpoint");return}if(!t.ciphertext||!t.nonce){w.error("Unexpected format for encrypted event, expected object with `ciphertext` and `nonce` fields, got: "+t);return}let n=Object(G.decode)(t.ciphertext);if(n.length<this.nacl.secretbox.overheadLength){w.error(`Expected encrypted event ciphertext length to be ${this.nacl.secretbox.overheadLength}, got: ${n.length}`);return}let r=Object(G.decode)(t.nonce);if(r.length<this.nacl.secretbox.nonceLength){w.error(`Expected encrypted event nonce length to be ${this.nacl.secretbox.nonceLength}, got: ${r.length}`);return}let i=this.nacl.secretbox.open(n,r,this.key);if(i!==null)this.emit(e,this.getDataToEmit(i));else{w.debug("Failed to decrypt an event, probably because it was encrypted with a different key. Fetching a new key from the authEndpoint...");this.authorize(this.pusher.connection.socket_id,((t,s)=>{if(t)w.error(`Failed to make a request to the authEndpoint: ${s}. Unable to fetch new key, so dropping encrypted event`);else{i=this.nacl.secretbox.open(n,r,this.key);i!==null?this.emit(e,this.getDataToEmit(i)):w.error("Failed to decrypt event with new key. Dropping encrypted event")}}))}}getDataToEmit(e){let t=Object(W.decode)(e);try{return JSON.parse(t)}catch(e){return t}}}class connection_manager_ConnectionManager extends dispatcher_Dispatcher{constructor(e,t){super();this.state="initialized";this.connection=null;this.key=e;this.options=t;this.timeline=this.options.timeline;this.usingTLS=this.options.useTLS;this.errorCallbacks=this.buildErrorCallbacks();this.connectionCallbacks=this.buildConnectionCallbacks(this.errorCallbacks);this.handshakeCallbacks=this.buildHandshakeCallbacks(this.errorCallbacks);var n=ge.getNetwork();n.bind("online",(()=>{this.timeline.info({netinfo:"online"});this.state!=="connecting"&&this.state!=="unavailable"||this.retryIn(0)}));n.bind("offline",(()=>{this.timeline.info({netinfo:"offline"});this.connection&&this.sendActivityCheck()}));this.updateStrategy()}switchCluster(e){this.key=e;this.updateStrategy();this.retryIn(0)}connect(){if(!this.connection&&!this.runner)if(this.strategy.isSupported()){this.updateState("connecting");this.startConnecting();this.setUnavailableTimer()}else this.updateState("failed")}send(e){return!!this.connection&&this.connection.send(e)}send_event(e,t,n){return!!this.connection&&this.connection.send_event(e,t,n)}disconnect(){this.disconnectInternally();this.updateState("disconnected")}isUsingTLS(){return this.usingTLS}startConnecting(){var callback=(e,t)=>{if(e)this.runner=this.strategy.connect(0,callback);else if(t.action==="error"){this.emit("error",{type:"HandshakeError",error:t.error});this.timeline.error({handshakeError:t.error})}else{this.abortConnecting();this.handshakeCallbacks[t.action](t)}};this.runner=this.strategy.connect(0,callback)}abortConnecting(){if(this.runner){this.runner.abort();this.runner=null}}disconnectInternally(){this.abortConnecting();this.clearRetryTimer();this.clearUnavailableTimer();if(this.connection){var e=this.abandonConnection();e.close()}}updateStrategy(){this.strategy=this.options.getStrategy({key:this.key,timeline:this.timeline,useTLS:this.usingTLS})}retryIn(e){this.timeline.info({action:"retry",delay:e});e>0&&this.emit("connecting_in",Math.round(e/1e3));this.retryTimer=new timers_OneOffTimer(e||0,(()=>{this.disconnectInternally();this.connect()}))}clearRetryTimer(){if(this.retryTimer){this.retryTimer.ensureAborted();this.retryTimer=null}}setUnavailableTimer(){this.unavailableTimer=new timers_OneOffTimer(this.options.unavailableTimeout,(()=>{this.updateState("unavailable")}))}clearUnavailableTimer(){this.unavailableTimer&&this.unavailableTimer.ensureAborted()}sendActivityCheck(){this.stopActivityCheck();this.connection.ping();this.activityTimer=new timers_OneOffTimer(this.options.pongTimeout,(()=>{this.timeline.error({pong_timed_out:this.options.pongTimeout});this.retryIn(0)}))}resetActivityCheck(){this.stopActivityCheck();this.connection&&!this.connection.handlesActivityChecks()&&(this.activityTimer=new timers_OneOffTimer(this.activityTimeout,(()=>{this.sendActivityCheck()})))}stopActivityCheck(){this.activityTimer&&this.activityTimer.ensureAborted()}buildConnectionCallbacks(e){return extend({},e,{message:e=>{this.resetActivityCheck();this.emit("message",e)},ping:()=>{this.send_event("pusher:pong",{})},activity:()=>{this.resetActivityCheck()},error:e=>{this.emit("error",e)},closed:()=>{this.abandonConnection();this.shouldRetry()&&this.retryIn(1e3)}})}buildHandshakeCallbacks(e){return extend({},e,{connected:e=>{this.activityTimeout=Math.min(this.options.activityTimeout,e.activityTimeout,e.connection.activityTimeout||Infinity);this.clearUnavailableTimer();this.setConnection(e.connection);this.socket_id=this.connection.id;this.updateState("connected",{socket_id:this.socket_id})}})}buildErrorCallbacks(){let withErrorEmitted=e=>t=>{t.error&&this.emit("error",{type:"WebSocketError",error:t.error});e(t)};return{tls_only:withErrorEmitted((()=>{this.usingTLS=true;this.updateStrategy();this.retryIn(0)})),refused:withErrorEmitted((()=>{this.disconnect()})),backoff:withErrorEmitted((()=>{this.retryIn(1e3)})),retry:withErrorEmitted((()=>{this.retryIn(0)}))}}setConnection(e){this.connection=e;for(var t in this.connectionCallbacks)this.connection.bind(t,this.connectionCallbacks[t]);this.resetActivityCheck()}abandonConnection(){if(this.connection){this.stopActivityCheck();for(var e in this.connectionCallbacks)this.connection.unbind(e,this.connectionCallbacks[e]);var t=this.connection;this.connection=null;return t}}updateState(e,t){var n=this.state;this.state=e;if(n!==e){var r=e;r==="connected"&&(r+=" with new socket ID "+t.socket_id);w.debug("State changed",n+" -> "+r);this.timeline.info({state:e,params:t});this.emit("state_change",{previous:n,current:e});this.emit(e,t)}}shouldRetry(){return this.state==="connecting"||this.state==="connected"}}class channels_Channels{constructor(){this.channels={}}add(e,t){this.channels[e]||(this.channels[e]=createChannel(e,t));return this.channels[e]}all(){return values(this.channels)}find(e){return this.channels[e]}remove(e){var t=this.channels[e];delete this.channels[e];return t}disconnect(){objectApply(this.channels,(function(e){e.disconnect()}))}}function createChannel(e,t){if(e.indexOf("private-encrypted-")===0){if(t.config.nacl)return V.createEncryptedChannel(e,t,t.config.nacl);let n="Tried to subscribe to a private-encrypted- channel but no nacl implementation available";let r=u.buildLogSuffix("encryptedChannelSupport");throw new UnsupportedFeature(`${n}. ${r}`)}if(e.indexOf("private-")===0)return V.createPrivateChannel(e,t);if(e.indexOf("presence-")===0)return V.createPresenceChannel(e,t);if(e.indexOf("#")===0)throw new BadChannelName('Cannot create a channel with name "'+e+'".');return V.createChannel(e,t)}var K={createChannels(){return new channels_Channels},createConnectionManager(e,t){return new connection_manager_ConnectionManager(e,t)},createChannel(e,t){return new channel_Channel(e,t)},createPrivateChannel(e,t){return new private_channel_PrivateChannel(e,t)},createPresenceChannel(e,t){return new presence_channel_PresenceChannel(e,t)},createEncryptedChannel(e,t,n){return new encrypted_channel_EncryptedChannel(e,t,n)},createTimelineSender(e,t){return new timeline_sender_TimelineSender(e,t)},createHandshake(e,t){return new handshake_Handshake(e,t)},createAssistantToTheTransportManager(e,t,n){return new assistant_to_the_transport_manager_AssistantToTheTransportManager(e,t,n)}};var V=K;class transport_manager_TransportManager{constructor(e){this.options=e||{};this.livesLeft=this.options.lives||Infinity}getAssistant(e){return V.createAssistantToTheTransportManager(this,e,{minPingDelay:this.options.minPingDelay,maxPingDelay:this.options.maxPingDelay})}isAlive(){return this.livesLeft>0}reportDeath(){this.livesLeft-=1}}class sequential_strategy_SequentialStrategy{constructor(e,t){this.strategies=e;this.loop=Boolean(t.loop);this.failFast=Boolean(t.failFast);this.timeout=t.timeout;this.timeoutLimit=t.timeoutLimit}isSupported(){return any(this.strategies,S.method("isSupported"))}connect(e,t){var n=this.strategies;var r=0;var i=this.timeout;var s=null;var tryNextStrategy=(o,a)=>{if(a)t(null,a);else{r+=1;this.loop&&(r%=n.length);if(r<n.length){if(i){i*=2;this.timeoutLimit&&(i=Math.min(i,this.timeoutLimit))}s=this.tryStrategy(n[r],e,{timeout:i,failFast:this.failFast},tryNextStrategy)}else t(true)}};s=this.tryStrategy(n[r],e,{timeout:i,failFast:this.failFast},tryNextStrategy);return{abort:function(){s.abort()},forceMinPriority:function(t){e=t;s&&s.forceMinPriority(t)}}}tryStrategy(e,t,n,r){var i=null;var s=null;n.timeout>0&&(i=new timers_OneOffTimer(n.timeout,(function(){s.abort();r(true)})));s=e.connect(t,(function(e,t){if(!(e&&i&&i.isRunning())||n.failFast){i&&i.ensureAborted();r(e,t)}}));return{abort:function(){i&&i.ensureAborted();s.abort()},forceMinPriority:function(e){s.forceMinPriority(e)}}}}class best_connected_ever_strategy_BestConnectedEverStrategy{constructor(e){this.strategies=e}isSupported(){return any(this.strategies,S.method("isSupported"))}connect(e,t){return connect(this.strategies,e,(function(e,n){return function(r,i){n[e].error=r;if(r)allRunnersFailed(n)&&t(true);else{apply(n,(function(e){e.forceMinPriority(i.transport.priority)}));t(null,i)}}}))}}function connect(e,t,n){var r=map(e,(function(e,r,i,s){return e.connect(t,n(r,s))}));return{abort:function(){apply(r,abortRunner)},forceMinPriority:function(e){apply(r,(function(t){t.forceMinPriority(e)}))}}}function allRunnersFailed(e){return collections_all(e,(function(e){return Boolean(e.error)}))}function abortRunner(e){if(!e.error&&!e.aborted){e.abort();e.aborted=true}}class websocket_prioritized_cached_strategy_WebSocketPrioritizedCachedStrategy{constructor(e,t,n){this.strategy=e;this.transports=t;this.ttl=n.ttl||18e5;this.usingTLS=n.useTLS;this.timeline=n.timeline}isSupported(){return this.strategy.isSupported()}connect(e,t){var n=this.usingTLS;var r=fetchTransportCache(n);var i=r&&r.cacheSkipCount?r.cacheSkipCount:0;var s=[this.strategy];if(r&&r.timestamp+this.ttl>=S.now()){var o=this.transports[r.transport];if(o)if(["ws","wss"].includes(r.transport)||i>3){this.timeline.info({cached:true,transport:r.transport,latency:r.latency});s.push(new sequential_strategy_SequentialStrategy([o],{timeout:r.latency*2+1e3,failFast:true}))}else i++}var a=S.now();var c=s.pop().connect(e,(function cb(r,o){if(r){flushTransportCache(n);if(s.length>0){a=S.now();c=s.pop().connect(e,cb)}else t(r)}else{storeTransportCache(n,o.transport.name,S.now()-a,i);t(null,o)}}));return{abort:function(){c.abort()},forceMinPriority:function(t){e=t;c&&c.forceMinPriority(t)}}}}function getTransportCacheKey(e){return"pusherTransport"+(e?"TLS":"NonTLS")}function fetchTransportCache(e){var t=ge.getLocalStorage();if(t)try{var n=t[getTransportCacheKey(e)];if(n)return JSON.parse(n)}catch(t){flushTransportCache(e)}return null}function storeTransportCache(e,t,n,r){var i=ge.getLocalStorage();if(i)try{i[getTransportCacheKey(e)]=safeJSONStringify({timestamp:S.now(),transport:t,latency:n,cacheSkipCount:r})}catch(e){}}function flushTransportCache(e){var t=ge.getLocalStorage();if(t)try{delete t[getTransportCacheKey(e)]}catch(e){}}class delayed_strategy_DelayedStrategy{constructor(e,{delay:t}){this.strategy=e;this.options={delay:t}}isSupported(){return this.strategy.isSupported()}connect(e,t){var n=this.strategy;var r;var i=new timers_OneOffTimer(this.options.delay,(function(){r=n.connect(e,t)}));return{abort:function(){i.ensureAborted();r&&r.abort()},forceMinPriority:function(t){e=t;r&&r.forceMinPriority(t)}}}}class IfStrategy{constructor(e,t,n){this.test=e;this.trueBranch=t;this.falseBranch=n}isSupported(){var e=this.test()?this.trueBranch:this.falseBranch;return e.isSupported()}connect(e,t){var n=this.test()?this.trueBranch:this.falseBranch;return n.connect(e,t)}}class FirstConnectedStrategy{constructor(e){this.strategy=e}isSupported(){return this.strategy.isSupported()}connect(e,t){var n=this.strategy.connect(e,(function(e,r){r&&n.abort();t(e,r)}));return n}}function testSupportsStrategy(e){return function(){return e.isSupported()}}var getDefaultStrategy=function(e,t,n){var r={};function defineTransportStrategy(t,i,s,o,a){var c=n(e,t,i,s,o,a);r[t]=c;return c}var i=Object.assign({},t,{hostNonTLS:e.wsHost+":"+e.wsPort,hostTLS:e.wsHost+":"+e.wssPort,httpPath:e.wsPath});var s=Object.assign({},i,{useTLS:true});var o=Object.assign({},t,{hostNonTLS:e.httpHost+":"+e.httpPort,hostTLS:e.httpHost+":"+e.httpsPort,httpPath:e.httpPath});var a={loop:true,timeout:15e3,timeoutLimit:6e4};var c=new transport_manager_TransportManager({minPingDelay:1e4,maxPingDelay:e.activityTimeout});var h=new transport_manager_TransportManager({lives:2,minPingDelay:1e4,maxPingDelay:e.activityTimeout});var u=defineTransportStrategy("ws","ws",3,i,c);var l=defineTransportStrategy("wss","ws",3,s,c);var d=defineTransportStrategy("sockjs","sockjs",1,o);var p=defineTransportStrategy("xhr_streaming","xhr_streaming",1,o,h);var f=defineTransportStrategy("xdr_streaming","xdr_streaming",1,o,h);var g=defineTransportStrategy("xhr_polling","xhr_polling",1,o);var v=defineTransportStrategy("xdr_polling","xdr_polling",1,o);var b=new sequential_strategy_SequentialStrategy([u],a);var m=new sequential_strategy_SequentialStrategy([l],a);var _=new sequential_strategy_SequentialStrategy([d],a);var y=new sequential_strategy_SequentialStrategy([new IfStrategy(testSupportsStrategy(p),p,f)],a);var S=new sequential_strategy_SequentialStrategy([new IfStrategy(testSupportsStrategy(g),g,v)],a);var w=new sequential_strategy_SequentialStrategy([new IfStrategy(testSupportsStrategy(y),new best_connected_ever_strategy_BestConnectedEverStrategy([y,new delayed_strategy_DelayedStrategy(S,{delay:4e3})]),S)],a);var C=new IfStrategy(testSupportsStrategy(w),w,_);var k;k=t.useTLS?new best_connected_ever_strategy_BestConnectedEverStrategy([b,new delayed_strategy_DelayedStrategy(C,{delay:2e3})]):new best_connected_ever_strategy_BestConnectedEverStrategy([b,new delayed_strategy_DelayedStrategy(m,{delay:2e3}),new delayed_strategy_DelayedStrategy(C,{delay:5e3})]);return new websocket_prioritized_cached_strategy_WebSocketPrioritizedCachedStrategy(new FirstConnectedStrategy(new IfStrategy(testSupportsStrategy(u),k,C)),r,{ttl:18e5,timeline:t.timeline,useTLS:t.useTLS})};var Q=getDefaultStrategy;var transport_connection_initializer=function(){var t=this||e;t.timeline.info(t.buildTimelineMessage({transport:t.name+(t.options.useTLS?"s":"")}));if(t.hooks.isInitialized())t.changeState("initialized");else if(t.hooks.file){t.changeState("initializing");c.load(t.hooks.file,{useTLS:t.options.useTLS},(function(e,n){if(t.hooks.isInitialized()){t.changeState("initialized");n(true)}else{e&&t.onError(e);t.onClose();n(false)}}))}else t.onClose()};var Y={getRequest:function(e){var t=new window.XDomainRequest;t.ontimeout=function(){e.emit("error",new RequestTimedOut);e.close()};t.onerror=function(t){e.emit("error",t);e.close()};t.onprogress=function(){t.responseText&&t.responseText.length>0&&e.onChunk(200,t.responseText)};t.onload=function(){t.responseText&&t.responseText.length>0&&e.onChunk(200,t.responseText);e.emit("finished",200);e.close()};return t},abortRequest:function(e){e.ontimeout=e.onerror=e.onprogress=e.onload=null;e.abort()}};var Z=Y;const ee=262144;class http_request_HTTPRequest extends dispatcher_Dispatcher{constructor(e,t,n){super();this.hooks=e;this.method=t;this.url=n}start(e){this.position=0;this.xhr=this.hooks.getRequest(this);this.unloader=()=>{this.close()};ge.addUnloadListener(this.unloader);this.xhr.open(this.method,this.url,true);this.xhr.setRequestHeader&&this.xhr.setRequestHeader("Content-Type","application/json");this.xhr.send(e)}close(){if(this.unloader){ge.removeUnloadListener(this.unloader);this.unloader=null}if(this.xhr){this.hooks.abortRequest(this.xhr);this.xhr=null}}onChunk(e,t){while(true){var n=this.advanceBuffer(t);if(!n)break;this.emit("chunk",{status:e,data:n})}this.isBufferTooLong(t)&&this.emit("buffer_too_long")}advanceBuffer(e){var t=e.slice(this.position);var n=t.indexOf("\n");if(n!==-1){this.position+=n+1;return t.slice(0,n)}return null}isBufferTooLong(e){return this.position===e.length&&e.length>ee}}var te;(function(e){e[e.CONNECTING=0]="CONNECTING";e[e.OPEN=1]="OPEN";e[e.CLOSED=3]="CLOSED"})(te||(te={}));var ne=te;var re=1;class http_socket_HTTPSocket{constructor(e,t){this.hooks=e;this.session=randomNumber(1e3)+"/"+randomString(8);this.location=getLocation(t);this.readyState=ne.CONNECTING;this.openStream()}send(e){return this.sendRaw(JSON.stringify([e]))}ping(){this.hooks.sendHeartbeat(this)}close(e,t){this.onClose(e,t,true)}sendRaw(e){if(this.readyState!==ne.OPEN)return false;try{ge.createSocketRequest("POST",getUniqueURL(getSendURL(this.location,this.session))).start(e);return true}catch(e){return false}}reconnect(){this.closeStream();this.openStream()}onClose(e,t,n){this.closeStream();this.readyState=ne.CLOSED;this.onclose&&this.onclose({code:e,reason:t,wasClean:n})}onChunk(e){if(e.status===200){this.readyState===ne.OPEN&&this.onActivity();var t;var n=e.data.slice(0,1);switch(n){case"o":t=JSON.parse(e.data.slice(1)||"{}");this.onOpen(t);break;case"a":t=JSON.parse(e.data.slice(1)||"[]");for(var r=0;r<t.length;r++)this.onEvent(t[r]);break;case"m":t=JSON.parse(e.data.slice(1)||"null");this.onEvent(t);break;case"h":this.hooks.onHeartbeat(this);break;case"c":t=JSON.parse(e.data.slice(1)||"[]");this.onClose(t[0],t[1],true);break}}}onOpen(e){if(this.readyState===ne.CONNECTING){e&&e.hostname&&(this.location.base=replaceHost(this.location.base,e.hostname));this.readyState=ne.OPEN;this.onopen&&this.onopen()}else this.onClose(1006,"Server lost session",true)}onEvent(e){this.readyState===ne.OPEN&&this.onmessage&&this.onmessage({data:e})}onActivity(){this.onactivity&&this.onactivity()}onError(e){this.onerror&&this.onerror(e)}openStream(){this.stream=ge.createSocketRequest("POST",getUniqueURL(this.hooks.getReceiveURL(this.location,this.session)));this.stream.bind("chunk",(e=>{this.onChunk(e)}));this.stream.bind("finished",(e=>{this.hooks.onFinished(this,e)}));this.stream.bind("buffer_too_long",(()=>{this.reconnect()}));try{this.stream.start()}catch(e){S.defer((()=>{this.onError(e);this.onClose(1006,"Could not start streaming",false)}))}}closeStream(){if(this.stream){this.stream.unbind_all();this.stream.close();this.stream=null}}}function getLocation(e){var t=/([^\?]*)\/*(\??.*)/.exec(e);return{base:t[1],queryString:t[2]}}function getSendURL(e,t){return e.base+"/"+t+"/xhr_send"}function getUniqueURL(e){var t=e.indexOf("?")===-1?"?":"&";return e+t+"t="+ +new Date+"&n="+re++}function replaceHost(e,t){var n=/(https?:\/\/)([^\/:]+)((\/|:)?.*)/.exec(e);return n[1]+t+n[3]}function randomNumber(e){return ge.randomInt(e)}function randomString(e){var t=[];for(var n=0;n<e;n++)t.push(randomNumber(32).toString(32));return t.join("")}var ie=http_socket_HTTPSocket;var se={getReceiveURL:function(e,t){return e.base+"/"+t+"/xhr_streaming"+e.queryString},onHeartbeat:function(e){e.sendRaw("[]")},sendHeartbeat:function(e){e.sendRaw("[]")},onFinished:function(e,t){e.onClose(1006,"Connection interrupted ("+t+")",false)}};var oe=se;var ae={getReceiveURL:function(e,t){return e.base+"/"+t+"/xhr"+e.queryString},onHeartbeat:function(){},sendHeartbeat:function(e){e.sendRaw("[]")},onFinished:function(e,t){t===200?e.reconnect():e.onClose(1006,"Connection interrupted ("+t+")",false)}};var ce=ae;var he={getRequest:function(e){var t=ge.getXHRAPI();var n=new t;n.onreadystatechange=n.onprogress=function(){switch(n.readyState){case 3:n.responseText&&n.responseText.length>0&&e.onChunk(n.status,n.responseText);break;case 4:n.responseText&&n.responseText.length>0&&e.onChunk(n.status,n.responseText);e.emit("finished",n.status);e.close();break}};return n},abortRequest:function(e){e.onreadystatechange=null;e.abort()}};var ue=he;var le={createStreamingSocket(e){return this.createSocket(oe,e)},createPollingSocket(e){return this.createSocket(ce,e)},createSocket(e,t){return new ie(e,t)},createXHR(e,t){return this.createRequest(ue,e,t)},createRequest(e,t,n){return new http_request_HTTPRequest(e,t,n)}};var de=le;de.createXDR=function(e,t){return this.createRequest(Z,e,t)};var pe=de;var fe={nextAuthCallbackID:1,auth_callbacks:{},ScriptReceivers:i,DependenciesReceivers:a,getDefaultStrategy:Q,Transports:B,transportConnectionInitializer:transport_connection_initializer,HTTPFactory:pe,TimelineTransport:T,getXHRAPI(){return window.XMLHttpRequest},getWebSocketAPI(){return window.WebSocket||window.MozWebSocket},setup(e){window.Pusher=e;var initializeOnDocumentBody=()=>{this.onDocumentBody(e.ready)};window.JSON?initializeOnDocumentBody():c.load("json2",{},initializeOnDocumentBody)},getDocument(){return document},getProtocol(){return this.getDocument().location.protocol},getAuthorizers(){return{ajax:d,jsonp:C}},onDocumentBody(e){document.body?e():setTimeout((()=>{this.onDocumentBody(e)}),0)},createJSONPRequest(e,t){return new jsonp_request_JSONPRequest(e,t)},createScriptRequest(e){return new ScriptRequest(e)},getLocalStorage(){try{return window.localStorage}catch(e){return}},createXHR(){return this.getXHRAPI()?this.createXMLHttpRequest():this.createMicrosoftXHR()},createXMLHttpRequest(){var e=this.getXHRAPI();return new e},createMicrosoftXHR(){return new ActiveXObject("Microsoft.XMLHTTP")},getNetwork(){return F},createWebSocket(e){var t=this.getWebSocketAPI();return new t(e)},createSocketRequest(t,n){if(this.isXHRSupported())return(this||e).HTTPFactory.createXHR(t,n);if(this.isXDRSupported(n.indexOf("https:")===0))return(this||e).HTTPFactory.createXDR(t,n);throw"Cross-origin HTTP requests are not supported"},isXHRSupported(){var e=this.getXHRAPI();return Boolean(e)&&(new e).withCredentials!==void 0},isXDRSupported(e){var t=e?"https:":"http:";var n=this.getProtocol();return Boolean(window.XDomainRequest)&&n===t},addUnloadListener(e){window.addEventListener!==void 0?window.addEventListener("unload",e,false):window.attachEvent!==void 0&&window.attachEvent("onunload",e)},removeUnloadListener(e){window.addEventListener!==void 0?window.removeEventListener("unload",e,false):window.detachEvent!==void 0&&window.detachEvent("onunload",e)},randomInt(e){const random=function(){const e=window.crypto||window.msCrypto;const t=e.getRandomValues(new Uint32Array(1))[0];return t/Math.pow(2,32)};return Math.floor(random()*e)}};var ge=fe;var ve;(function(e){e[e.ERROR=3]="ERROR";e[e.INFO=6]="INFO";e[e.DEBUG=7]="DEBUG"})(ve||(ve={}));var be=ve;class timeline_Timeline{constructor(e,t,n){this.key=e;this.session=t;this.events=[];this.options=n||{};this.sent=0;this.uniqueID=0}log(e,t){if(e<=this.options.level){this.events.push(extend({},t,{timestamp:S.now()}));this.options.limit&&this.events.length>this.options.limit&&this.events.shift()}}error(e){this.log(be.ERROR,e)}info(e){this.log(be.INFO,e)}debug(e){this.log(be.DEBUG,e)}isEmpty(){return this.events.length===0}send(e,t){var n=extend({session:this.session,bundle:this.sent+1,key:this.key,lib:"js",version:this.options.version,cluster:this.options.cluster,features:this.options.features,timeline:this.events},this.options.params);this.events=[];e(n,((e,n)=>{e||this.sent++;t&&t(e,n)}));return true}generateUniqueID(){this.uniqueID++;return this.uniqueID}}class transport_strategy_TransportStrategy{constructor(e,t,n,r){this.name=e;this.priority=t;this.transport=n;this.options=r||{}}isSupported(){return this.transport.isSupported({useTLS:this.options.useTLS})}connect(e,t){if(!this.isSupported())return failAttempt(new UnsupportedStrategy,t);if(this.priority<e)return failAttempt(new TransportPriorityTooLow,t);var n=false;var r=this.transport.createConnection(this.name,this.priority,this.options.key,this.options);var i=null;var onInitialized=function(){r.unbind("initialized",onInitialized);r.connect()};var onOpen=function(){i=V.createHandshake(r,(function(e){n=true;unbindListeners();t(null,e)}))};var onError=function(e){unbindListeners();t(e)};var onClosed=function(){unbindListeners();var e;e=safeJSONStringify(r);t(new TransportClosed(e))};var unbindListeners=function(){r.unbind("initialized",onInitialized);r.unbind("open",onOpen);r.unbind("error",onError);r.unbind("closed",onClosed)};r.bind("initialized",onInitialized);r.bind("open",onOpen);r.bind("error",onError);r.bind("closed",onClosed);r.initialize();return{abort:()=>{if(!n){unbindListeners();i?i.close():r.close()}},forceMinPriority:e=>{n||this.priority<e&&(i?i.close():r.close())}}}}function failAttempt(e,t){S.defer((function(){t(e)}));return{abort:function(){},forceMinPriority:function(){}}}const{Transports:me}=ge;var strategy_builder_defineTransport=function(e,t,n,r,i,s){var o=me[n];if(!o)throw new UnsupportedTransport(n);var a=(!e.enabledTransports||arrayIndexOf(e.enabledTransports,t)!==-1)&&(!e.disabledTransports||arrayIndexOf(e.disabledTransports,t)===-1);var c;if(a){i=Object.assign({ignoreNullOrigin:e.ignoreNullOrigin},i);c=new transport_strategy_TransportStrategy(t,r,s?s.getAssistant(o):o,i)}else c=_e;return c};var _e={isSupported:function(){return false},connect:function(e,t){var n=S.defer((function(){t(new UnsupportedStrategy)}));return{abort:function(){n.ensureAborted()},forceMinPriority:function(){}}}};function validateOptions(e){if(e==null)throw"You must pass an options object";if(e.cluster==null)throw"Options object must provide a cluster";"disableStats"in e&&w.warn("The disableStats option is deprecated in favor of enableStats")}const composeChannelQuery=(e,t)=>{var n="socket_id="+encodeURIComponent(e.socketId);for(var r in t.params)n+="&"+encodeURIComponent(r)+"="+encodeURIComponent(t.params[r]);if(t.paramsProvider!=null){let e=t.paramsProvider();for(var r in e)n+="&"+encodeURIComponent(r)+"="+encodeURIComponent(e[r])}return n};const UserAuthenticator=e=>{if(typeof ge.getAuthorizers()[e.transport]==="undefined")throw`'${e.transport}' is not a recognized auth transport`;return(t,n)=>{const r=composeChannelQuery(t,e);ge.getAuthorizers()[e.transport](ge,r,e,l.UserAuthentication,n)}};var ye=UserAuthenticator;const channel_authorizer_composeChannelQuery=(e,t)=>{var n="socket_id="+encodeURIComponent(e.socketId);n+="&channel_name="+encodeURIComponent(e.channelName);for(var r in t.params)n+="&"+encodeURIComponent(r)+"="+encodeURIComponent(t.params[r]);if(t.paramsProvider!=null){let e=t.paramsProvider();for(var r in e)n+="&"+encodeURIComponent(r)+"="+encodeURIComponent(e[r])}return n};const ChannelAuthorizer=e=>{if(typeof ge.getAuthorizers()[e.transport]==="undefined")throw`'${e.transport}' is not a recognized auth transport`;return(t,n)=>{const r=channel_authorizer_composeChannelQuery(t,e);ge.getAuthorizers()[e.transport](ge,r,e,l.ChannelAuthorization,n)}};var Se=ChannelAuthorizer;const ChannelAuthorizerProxy=(e,t,n)=>{const r={authTransport:t.transport,authEndpoint:t.endpoint,auth:{params:t.params,headers:t.headers}};return(t,i)=>{const s=e.channel(t.channelName);const o=n(s,r);o.authorize(t.socketId,i)}};function getConfig(e,t){let n={activityTimeout:e.activityTimeout||o.activityTimeout,cluster:e.cluster,httpPath:e.httpPath||o.httpPath,httpPort:e.httpPort||o.httpPort,httpsPort:e.httpsPort||o.httpsPort,pongTimeout:e.pongTimeout||o.pongTimeout,statsHost:e.statsHost||o.stats_host,unavailableTimeout:e.unavailableTimeout||o.unavailableTimeout,wsPath:e.wsPath||o.wsPath,wsPort:e.wsPort||o.wsPort,wssPort:e.wssPort||o.wssPort,enableStats:getEnableStatsConfig(e),httpHost:getHttpHost(e),useTLS:shouldUseTLS(e),wsHost:getWebsocketHost(e),userAuthenticator:buildUserAuthenticator(e),channelAuthorizer:buildChannelAuthorizer(e,t)};"disabledTransports"in e&&(n.disabledTransports=e.disabledTransports);"enabledTransports"in e&&(n.enabledTransports=e.enabledTransports);"ignoreNullOrigin"in e&&(n.ignoreNullOrigin=e.ignoreNullOrigin);"timelineParams"in e&&(n.timelineParams=e.timelineParams);"nacl"in e&&(n.nacl=e.nacl);return n}function getHttpHost(e){return e.httpHost?e.httpHost:e.cluster?`sockjs-${e.cluster}.pusher.com`:o.httpHost}function getWebsocketHost(e){return e.wsHost?e.wsHost:getWebsocketHostFromCluster(e.cluster)}function getWebsocketHostFromCluster(e){return`ws-${e}.pusher.com`}function shouldUseTLS(e){return ge.getProtocol()==="https:"||e.forceTLS!==false}function getEnableStatsConfig(e){return"enableStats"in e?e.enableStats:"disableStats"in e&&!e.disableStats}const hasCustomHandler=e=>"customHandler"in e&&e.customHandler!=null;function buildUserAuthenticator(e){const t=Object.assign(Object.assign({},o.userAuthentication),e.userAuthentication);return hasCustomHandler(t)?t.customHandler:ye(t)}function buildChannelAuth(e,t){let n;if("channelAuthorization"in e)n=Object.assign(Object.assign({},o.channelAuthorization),e.channelAuthorization);else{n={transport:e.authTransport||o.authTransport,endpoint:e.authEndpoint||o.authEndpoint};if("auth"in e){"params"in e.auth&&(n.params=e.auth.params);"headers"in e.auth&&(n.headers=e.auth.headers)}if("authorizer"in e)return{customHandler:ChannelAuthorizerProxy(t,n,e.authorizer)}}return n}function buildChannelAuthorizer(e,t){const n=buildChannelAuth(e,t);return hasCustomHandler(n)?n.customHandler:Se(n)}class watchlist_WatchlistFacade extends dispatcher_Dispatcher{constructor(e){super((function(e,t){w.debug(`No callbacks on watchlist events for ${e}`)}));this.pusher=e;this.bindWatchlistInternalEvent()}handleEvent(e){e.data.events.forEach((e=>{this.emit(e.name,e)}))}bindWatchlistInternalEvent(){this.pusher.connection.bind("message",(e=>{var t=e.event;t==="pusher_internal:watchlist_events"&&this.handleEvent(e)}))}}function flatPromise(){let e,t;const n=new Promise(((n,r)=>{e=n;t=r}));return{promise:n,resolve:e,reject:t}}var we=flatPromise;class user_UserFacade extends dispatcher_Dispatcher{constructor(e){super((function(e,t){w.debug("No callbacks on user for "+e)}));this.signin_requested=false;this.user_data=null;this.serverToUserChannel=null;this.signinDonePromise=null;this._signinDoneResolve=null;this._onAuthorize=(e,t)=>{if(e){w.warn(`Error during signin: ${e}`);this._cleanup()}else this.pusher.send_event("pusher:signin",{auth:t.auth,user_data:t.user_data})};this.pusher=e;this.pusher.connection.bind("state_change",(({previous:e,current:t})=>{e!=="connected"&&t==="connected"&&this._signin();if(e==="connected"&&t!=="connected"){this._cleanup();this._newSigninPromiseIfNeeded()}}));this.watchlist=new watchlist_WatchlistFacade(e);this.pusher.connection.bind("message",(e=>{var t=e.event;t==="pusher:signin_success"&&this._onSigninSuccess(e.data);this.serverToUserChannel&&this.serverToUserChannel.name===e.channel&&this.serverToUserChannel.handleEvent(e)}))}signin(){if(!this.signin_requested){this.signin_requested=true;this._signin()}}_signin(){if(this.signin_requested){this._newSigninPromiseIfNeeded();this.pusher.connection.state==="connected"&&this.pusher.config.userAuthenticator({socketId:this.pusher.connection.socket_id},this._onAuthorize)}}_onSigninSuccess(e){try{this.user_data=JSON.parse(e.user_data)}catch(t){w.error(`Failed parsing user data after signin: ${e.user_data}`);this._cleanup();return}if(typeof this.user_data.id==="string"&&this.user_data.id!==""){this._signinDoneResolve();this._subscribeChannels()}else{w.error(`user_data doesn't contain an id. user_data: ${this.user_data}`);this._cleanup()}}_subscribeChannels(){const ensure_subscribed=e=>{e.subscriptionPending&&e.subscriptionCancelled?e.reinstateSubscription():e.subscriptionPending||this.pusher.connection.state!=="connected"||e.subscribe()};this.serverToUserChannel=new channel_Channel(`#server-to-user-${this.user_data.id}`,this.pusher);this.serverToUserChannel.bind_global(((e,t)=>{e.indexOf("pusher_internal:")!==0&&e.indexOf("pusher:")!==0&&this.emit(e,t)}));ensure_subscribed(this.serverToUserChannel)}_cleanup(){this.user_data=null;if(this.serverToUserChannel){this.serverToUserChannel.unbind_all();this.serverToUserChannel.disconnect();this.serverToUserChannel=null}this.signin_requested&&this._signinDoneResolve()}_newSigninPromiseIfNeeded(){if(!this.signin_requested)return;if(this.signinDonePromise&&!this.signinDonePromise.done)return;const{promise:e,resolve:t,reject:n}=we();e.done=false;const setDone=()=>{e.done=true};e.then(setDone).catch(setDone);this.signinDonePromise=e;this._signinDoneResolve=t}}class pusher_Pusher{static ready(){pusher_Pusher.isReady=true;for(var e=0,t=pusher_Pusher.instances.length;e<t;e++)pusher_Pusher.instances[e].connect()}static getClientFeatures(){return keys(filterObject({ws:ge.Transports.ws},(function(e){return e.isSupported({})})))}constructor(e,t){checkAppKey(e);validateOptions(t);this.key=e;this.options=t;this.config=getConfig(this.options,this);this.channels=V.createChannels();this.global_emitter=new dispatcher_Dispatcher;this.sessionID=ge.randomInt(1e9);this.timeline=new timeline_Timeline(this.key,this.sessionID,{cluster:this.config.cluster,features:pusher_Pusher.getClientFeatures(),params:this.config.timelineParams||{},limit:50,level:be.INFO,version:o.VERSION});this.config.enableStats&&(this.timelineSender=V.createTimelineSender(this.timeline,{host:this.config.statsHost,path:"/timeline/v2/"+ge.TimelineTransport.name}));var getStrategy=e=>ge.getDefaultStrategy(this.config,e,strategy_builder_defineTransport);this.connection=V.createConnectionManager(this.key,{getStrategy:getStrategy,timeline:this.timeline,activityTimeout:this.config.activityTimeout,pongTimeout:this.config.pongTimeout,unavailableTimeout:this.config.unavailableTimeout,useTLS:Boolean(this.config.useTLS)});this.connection.bind("connected",(()=>{this.subscribeAll();this.timelineSender&&this.timelineSender.send(this.connection.isUsingTLS())}));this.connection.bind("message",(e=>{var t=e.event;var n=t.indexOf("pusher_internal:")===0;if(e.channel){var r=this.channel(e.channel);r&&r.handleEvent(e)}n||this.global_emitter.emit(e.event,e.data)}));this.connection.bind("connecting",(()=>{this.channels.disconnect()}));this.connection.bind("disconnected",(()=>{this.channels.disconnect()}));this.connection.bind("error",(e=>{w.warn(e)}));pusher_Pusher.instances.push(this);this.timeline.info({instances:pusher_Pusher.instances.length});this.user=new user_UserFacade(this);pusher_Pusher.isReady&&this.connect()}switchCluster(e){const{appKey:t,cluster:n}=e;this.key=t;this.options=Object.assign(Object.assign({},this.options),{cluster:n});this.config=getConfig(this.options,this);this.connection.switchCluster(this.key)}channel(e){return this.channels.find(e)}allChannels(){return this.channels.all()}connect(){this.connection.connect();if(this.timelineSender&&!this.timelineSenderTimer){var e=this.connection.isUsingTLS();var t=this.timelineSender;this.timelineSenderTimer=new timers_PeriodicTimer(6e4,(function(){t.send(e)}))}}disconnect(){this.connection.disconnect();if(this.timelineSenderTimer){this.timelineSenderTimer.ensureAborted();this.timelineSenderTimer=null}}bind(e,t,n){this.global_emitter.bind(e,t,n);return this}unbind(e,t,n){this.global_emitter.unbind(e,t,n);return this}bind_global(e){this.global_emitter.bind_global(e);return this}unbind_global(e){this.global_emitter.unbind_global(e);return this}unbind_all(e){this.global_emitter.unbind_all();return this}subscribeAll(){var e;for(e in this.channels.channels)this.channels.channels.hasOwnProperty(e)&&this.subscribe(e)}subscribe(e){var t=this.channels.add(e,this);t.subscriptionPending&&t.subscriptionCancelled?t.reinstateSubscription():t.subscriptionPending||this.connection.state!=="connected"||t.subscribe();return t}unsubscribe(e){var t=this.channels.find(e);if(t&&t.subscriptionPending)t.cancelSubscription();else{t=this.channels.remove(e);t&&t.subscribed&&t.unsubscribe()}}send_event(e,t,n){return this.connection.send_event(e,t,n)}shouldUseTLS(){return this.config.useTLS}signin(){this.user.signin()}}pusher_Pusher.instances=[];pusher_Pusher.isReady=false;pusher_Pusher.logToConsole=false;pusher_Pusher.Runtime=ge;pusher_Pusher.ScriptReceivers=ge.ScriptReceivers;pusher_Pusher.DependenciesReceivers=ge.DependenciesReceivers;pusher_Pusher.auth_callbacks=ge.auth_callbacks;var Ce=n.default=pusher_Pusher;function checkAppKey(e){if(e===null||e===void 0)throw"You must pass your app key when you instantiate Pusher."}ge.setup(pusher_Pusher)}])}));var n=t;const r=t.Pusher,i=t.__esModule,s=t.Coder,o=t.encode,a=t.decode,c=t.URLSafeCoder,h=t.encodeURLSafe,u=t.decodeURLSafe,l=t.encodedLength,d=t.maxDecodedLength,p=t.decodedLength;export{s as Coder,r as Pusher,c as URLSafeCoder,i as __esModule,a as decode,u as decodeURLSafe,p as decodedLength,n as default,o as encode,h as encodeURLSafe,l as encodedLength,d as maxDecodedLength};


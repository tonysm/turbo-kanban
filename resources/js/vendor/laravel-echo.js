function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function _classCallCheck(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||false;r.configurable=true;"value"in r&&(r.writable=true);Object.defineProperty(e,r.key,r)}}function _createClass(e,n,t){n&&_defineProperties(e.prototype,n);t&&_defineProperties(e,t);Object.defineProperty(e,"prototype",{writable:false});return e}function _extends(){_extends=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e};return _extends.apply(this,arguments)}function _inherits(e,n){if(typeof n!=="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:true,configurable:true}});Object.defineProperty(e,"prototype",{writable:false});n&&_setPrototypeOf(e,n)}function _getPrototypeOf(e){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(e){return e.__proto__||Object.getPrototypeOf(e)};return _getPrototypeOf(e)}function _setPrototypeOf(e,n){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(e,n){e.__proto__=n;return e};return _setPrototypeOf(e,n)}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})));return true}catch(e){return false}}function _assertThisInitialized(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,n){if(n&&(typeof n==="object"||typeof n==="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(e)}function _createSuper(e){var n=_isNativeReflectConstruct();return function _createSuperInternal(){var t,r=_getPrototypeOf(e);if(n){var s=_getPrototypeOf(this).constructor;t=Reflect.construct(r,arguments,s)}else t=r.apply(this,arguments);return _possibleConstructorReturn(this,t)}}var e=function(){function Channel(){_classCallCheck(this,Channel)}_createClass(Channel,[{key:"listenForWhisper",value:function listenForWhisper(e,n){return this.listen(".client-"+e,n)}},{key:"notification",value:function notification(e){return this.listen(".Illuminate\\Notifications\\Events\\BroadcastNotificationCreated",e)}},{key:"stopListeningForWhisper",value:function stopListeningForWhisper(e,n){return this.stopListening(".client-"+e,n)}}]);return Channel}();var n=function(){function EventFormatter(e){_classCallCheck(this,EventFormatter);this.namespace=e}_createClass(EventFormatter,[{key:"format",value:function format(e){if(e.charAt(0)==="."||e.charAt(0)==="\\")return e.substr(1);this.namespace&&(e=this.namespace+"."+e);return e.replace(/\./g,"\\")}},{key:"setNamespace",value:function setNamespace(e){this.namespace=e}}]);return EventFormatter}();var t=function(e){_inherits(PusherChannel,e);var t=_createSuper(PusherChannel);function PusherChannel(e,r,s){var i;_classCallCheck(this,PusherChannel);i=t.call(this);i.name=r;i.pusher=e;i.options=s;i.eventFormatter=new n(i.options.namespace);i.subscribe();return i}_createClass(PusherChannel,[{key:"subscribe",value:function subscribe(){this.subscription=this.pusher.subscribe(this.name)}},{key:"unsubscribe",value:function unsubscribe(){this.pusher.unsubscribe(this.name)}},{key:"listen",value:function listen(e,n){this.on(this.eventFormatter.format(e),n);return this}},{key:"listenToAll",value:function listenToAll(e){var n=this;this.subscription.bind_global((function(t,r){if(!t.startsWith("pusher:")){var s=n.options.namespace.replace(/\./g,"\\");var i=t.startsWith(s)?t.substring(s.length+1):"."+t;e(i,r)}}));return this}},{key:"stopListening",value:function stopListening(e,n){n?this.subscription.unbind(this.eventFormatter.format(e),n):this.subscription.unbind(this.eventFormatter.format(e));return this}},{key:"stopListeningToAll",value:function stopListeningToAll(e){e?this.subscription.unbind_global(e):this.subscription.unbind_global();return this}},{key:"subscribed",value:function subscribed(e){this.on("pusher:subscription_succeeded",(function(){e()}));return this}},{key:"error",value:function error(e){this.on("pusher:subscription_error",(function(n){e(n)}));return this}},{key:"on",value:function on(e,n){this.subscription.bind(e,n);return this}}]);return PusherChannel}(e);var r=function(e){_inherits(PusherPrivateChannel,e);var n=_createSuper(PusherPrivateChannel);function PusherPrivateChannel(){_classCallCheck(this,PusherPrivateChannel);return n.apply(this,arguments)}_createClass(PusherPrivateChannel,[{key:"whisper",value:function whisper(e,n){this.pusher.channels.channels[this.name].trigger("client-".concat(e),n);return this}}]);return PusherPrivateChannel}(t);var s=function(e){_inherits(PusherEncryptedPrivateChannel,e);var n=_createSuper(PusherEncryptedPrivateChannel);function PusherEncryptedPrivateChannel(){_classCallCheck(this,PusherEncryptedPrivateChannel);return n.apply(this,arguments)}_createClass(PusherEncryptedPrivateChannel,[{key:"whisper",value:function whisper(e,n){this.pusher.channels.channels[this.name].trigger("client-".concat(e),n);return this}}]);return PusherEncryptedPrivateChannel}(t);var i=function(e){_inherits(PusherPresenceChannel,e);var n=_createSuper(PusherPresenceChannel);function PusherPresenceChannel(){_classCallCheck(this,PusherPresenceChannel);return n.apply(this,arguments)}_createClass(PusherPresenceChannel,[{key:"here",value:function here(e){this.on("pusher:subscription_succeeded",(function(n){e(Object.keys(n.members).map((function(e){return n.members[e]})))}));return this}},{key:"joining",value:function joining(e){this.on("pusher:member_added",(function(n){e(n.info)}));return this}},{key:"whisper",value:function whisper(e,n){this.pusher.channels.channels[this.name].trigger("client-".concat(e),n);return this}},{key:"leaving",value:function leaving(e){this.on("pusher:member_removed",(function(n){e(n.info)}));return this}}]);return PusherPresenceChannel}(t);var o=function(e){_inherits(SocketIoChannel,e);var t=_createSuper(SocketIoChannel);function SocketIoChannel(e,r,s){var i;_classCallCheck(this,SocketIoChannel);i=t.call(this);i.events={};i.listeners={};i.name=r;i.socket=e;i.options=s;i.eventFormatter=new n(i.options.namespace);i.subscribe();return i}_createClass(SocketIoChannel,[{key:"subscribe",value:function subscribe(){this.socket.emit("subscribe",{channel:this.name,auth:this.options.auth||{}})}},{key:"unsubscribe",value:function unsubscribe(){this.unbind();this.socket.emit("unsubscribe",{channel:this.name,auth:this.options.auth||{}})}},{key:"listen",value:function listen(e,n){this.on(this.eventFormatter.format(e),n);return this}},{key:"stopListening",value:function stopListening(e,n){this.unbindEvent(this.eventFormatter.format(e),n);return this}},{key:"subscribed",value:function subscribed(e){this.on("connect",(function(n){e(n)}));return this}},{key:"error",value:function error(e){return this}},{key:"on",value:function on(e,n){var t=this;this.listeners[e]=this.listeners[e]||[];if(!this.events[e]){this.events[e]=function(n,r){t.name===n&&t.listeners[e]&&t.listeners[e].forEach((function(e){return e(r)}))};this.socket.on(e,this.events[e])}this.listeners[e].push(n);return this}},{key:"unbind",value:function unbind(){var e=this;Object.keys(this.events).forEach((function(n){e.unbindEvent(n)}))}},{key:"unbindEvent",value:function unbindEvent(e,n){this.listeners[e]=this.listeners[e]||[];n&&(this.listeners[e]=this.listeners[e].filter((function(e){return e!==n})));if(!n||this.listeners[e].length===0){if(this.events[e]){this.socket.removeListener(e,this.events[e]);delete this.events[e]}delete this.listeners[e]}}}]);return SocketIoChannel}(e);var c=function(e){_inherits(SocketIoPrivateChannel,e);var n=_createSuper(SocketIoPrivateChannel);function SocketIoPrivateChannel(){_classCallCheck(this,SocketIoPrivateChannel);return n.apply(this,arguments)}_createClass(SocketIoPrivateChannel,[{key:"whisper",value:function whisper(e,n){this.socket.emit("client event",{channel:this.name,event:"client-".concat(e),data:n});return this}}]);return SocketIoPrivateChannel}(o);var a=function(e){_inherits(SocketIoPresenceChannel,e);var n=_createSuper(SocketIoPresenceChannel);function SocketIoPresenceChannel(){_classCallCheck(this,SocketIoPresenceChannel);return n.apply(this,arguments)}_createClass(SocketIoPresenceChannel,[{key:"here",value:function here(e){this.on("presence:subscribed",(function(n){e(n.map((function(e){return e.user_info})))}));return this}},{key:"joining",value:function joining(e){this.on("presence:joining",(function(n){return e(n.user_info)}));return this}},{key:"whisper",value:function whisper(e,n){this.socket.emit("client event",{channel:this.name,event:"client-".concat(e),data:n});return this}},{key:"leaving",value:function leaving(e){this.on("presence:leaving",(function(n){return e(n.user_info)}));return this}}]);return SocketIoPresenceChannel}(c);var u=function(e){_inherits(NullChannel,e);var n=_createSuper(NullChannel);function NullChannel(){_classCallCheck(this,NullChannel);return n.apply(this,arguments)}_createClass(NullChannel,[{key:"subscribe",value:function subscribe(){}},{key:"unsubscribe",value:function unsubscribe(){}},{key:"listen",value:function listen(e,n){return this}},{key:"listenToAll",value:function listenToAll(e){return this}},{key:"stopListening",value:function stopListening(e,n){return this}},{key:"subscribed",value:function subscribed(e){return this}},{key:"error",value:function error(e){return this}},{key:"on",value:function on(e,n){return this}}]);return NullChannel}(e);var h=function(e){_inherits(NullPrivateChannel,e);var n=_createSuper(NullPrivateChannel);function NullPrivateChannel(){_classCallCheck(this,NullPrivateChannel);return n.apply(this,arguments)}_createClass(NullPrivateChannel,[{key:"whisper",value:function whisper(e,n){return this}}]);return NullPrivateChannel}(u);var l=function(e){_inherits(NullPresenceChannel,e);var n=_createSuper(NullPresenceChannel);function NullPresenceChannel(){_classCallCheck(this,NullPresenceChannel);return n.apply(this,arguments)}_createClass(NullPresenceChannel,[{key:"here",value:function here(e){return this}},{key:"joining",value:function joining(e){return this}},{key:"whisper",value:function whisper(e,n){return this}},{key:"leaving",value:function leaving(e){return this}}]);return NullPresenceChannel}(u);var p=function(){function Connector(e){_classCallCheck(this,Connector);this._defaultOptions={auth:{headers:{}},authEndpoint:"/broadcasting/auth",userAuthentication:{endpoint:"/broadcasting/user-auth",headers:{}},broadcaster:"pusher",csrfToken:null,bearerToken:null,host:null,key:null,namespace:"App.Events"};this.setOptions(e);this.connect()}_createClass(Connector,[{key:"setOptions",value:function setOptions(e){this.options=_extends(this._defaultOptions,e);var n=this.csrfToken();if(n){this.options.auth.headers["X-CSRF-TOKEN"]=n;this.options.userAuthentication.headers["X-CSRF-TOKEN"]=n}n=this.options.bearerToken;if(n){this.options.auth.headers.Authorization="Bearer "+n;this.options.userAuthentication.headers.Authorization="Bearer "+n}return e}},{key:"csrfToken",value:function csrfToken(){var e;return typeof window!=="undefined"&&window.Laravel&&window.Laravel.csrfToken?window.Laravel.csrfToken:this.options.csrfToken?this.options.csrfToken:typeof document!=="undefined"&&typeof document.querySelector==="function"&&(e=document.querySelector('meta[name="csrf-token"]'))?e.getAttribute("content"):null}}]);return Connector}();var f=function(e){_inherits(PusherConnector,e);var n=_createSuper(PusherConnector);function PusherConnector(){var e;_classCallCheck(this,PusherConnector);e=n.apply(this,arguments);e.channels={};return e}_createClass(PusherConnector,[{key:"connect",value:function connect(){typeof this.options.client!=="undefined"?this.pusher=this.options.client:this.options.Pusher?this.pusher=new this.options.Pusher(this.options.key,this.options):this.pusher=new Pusher(this.options.key,this.options)}},{key:"signin",value:function signin(){this.pusher.signin()}},{key:"listen",value:function listen(e,n,t){return this.channel(e).listen(n,t)}},{key:"channel",value:function channel(e){this.channels[e]||(this.channels[e]=new t(this.pusher,e,this.options));return this.channels[e]}},{key:"privateChannel",value:function privateChannel(e){this.channels["private-"+e]||(this.channels["private-"+e]=new r(this.pusher,"private-"+e,this.options));return this.channels["private-"+e]}},{key:"encryptedPrivateChannel",value:function encryptedPrivateChannel(e){this.channels["private-encrypted-"+e]||(this.channels["private-encrypted-"+e]=new s(this.pusher,"private-encrypted-"+e,this.options));return this.channels["private-encrypted-"+e]}},{key:"presenceChannel",value:function presenceChannel(e){this.channels["presence-"+e]||(this.channels["presence-"+e]=new i(this.pusher,"presence-"+e,this.options));return this.channels["presence-"+e]}},{key:"leave",value:function leave(e){var n=this;var t=[e,"private-"+e,"private-encrypted-"+e,"presence-"+e];t.forEach((function(e,t){n.leaveChannel(e)}))}},{key:"leaveChannel",value:function leaveChannel(e){if(this.channels[e]){this.channels[e].unsubscribe();delete this.channels[e]}}},{key:"socketId",value:function socketId(){return this.pusher.connection.socket_id}},{key:"disconnect",value:function disconnect(){this.pusher.disconnect()}}]);return PusherConnector}(p);var v=function(e){_inherits(SocketIoConnector,e);var n=_createSuper(SocketIoConnector);function SocketIoConnector(){var e;_classCallCheck(this,SocketIoConnector);e=n.apply(this,arguments);e.channels={};return e}_createClass(SocketIoConnector,[{key:"connect",value:function connect(){var e=this;var n=this.getSocketIO();this.socket=n(this.options.host,this.options);this.socket.on("reconnect",(function(){Object.values(e.channels).forEach((function(e){e.subscribe()}))}));return this.socket}},{key:"getSocketIO",value:function getSocketIO(){if(typeof this.options.client!=="undefined")return this.options.client;if(typeof io!=="undefined")return io;throw new Error("Socket.io client not found. Should be globally available or passed via options.client")}},{key:"listen",value:function listen(e,n,t){return this.channel(e).listen(n,t)}},{key:"channel",value:function channel(e){this.channels[e]||(this.channels[e]=new o(this.socket,e,this.options));return this.channels[e]}},{key:"privateChannel",value:function privateChannel(e){this.channels["private-"+e]||(this.channels["private-"+e]=new c(this.socket,"private-"+e,this.options));return this.channels["private-"+e]}},{key:"presenceChannel",value:function presenceChannel(e){this.channels["presence-"+e]||(this.channels["presence-"+e]=new a(this.socket,"presence-"+e,this.options));return this.channels["presence-"+e]}},{key:"leave",value:function leave(e){var n=this;var t=[e,"private-"+e,"presence-"+e];t.forEach((function(e){n.leaveChannel(e)}))}},{key:"leaveChannel",value:function leaveChannel(e){if(this.channels[e]){this.channels[e].unsubscribe();delete this.channels[e]}}},{key:"socketId",value:function socketId(){return this.socket.id}},{key:"disconnect",value:function disconnect(){this.socket.disconnect()}}]);return SocketIoConnector}(p);var y=function(e){_inherits(NullConnector,e);var n=_createSuper(NullConnector);function NullConnector(){var e;_classCallCheck(this,NullConnector);e=n.apply(this,arguments);e.channels={};return e}_createClass(NullConnector,[{key:"connect",value:function connect(){}},{key:"listen",value:function listen(e,n,t){return new u}},{key:"channel",value:function channel(e){return new u}},{key:"privateChannel",value:function privateChannel(e){return new h}},{key:"encryptedPrivateChannel",value:function encryptedPrivateChannel(e){return new h}},{key:"presenceChannel",value:function presenceChannel(e){return new l}},{key:"leave",value:function leave(e){}},{key:"leaveChannel",value:function leaveChannel(e){}},{key:"socketId",value:function socketId(){return"fake-socket-id"}},{key:"disconnect",value:function disconnect(){}}]);return NullConnector}(p);var k=function(){function Echo(e){_classCallCheck(this,Echo);this.options=e;this.connect();this.options.withoutInterceptors||this.registerInterceptors()}_createClass(Echo,[{key:"channel",value:function channel(e){return this.connector.channel(e)}},{key:"connect",value:function connect(){this.options.broadcaster=="reverb"?this.connector=new f(_extends(_extends({},this.options),{cluster:""})):this.options.broadcaster=="pusher"?this.connector=new f(this.options):this.options.broadcaster=="socket.io"?this.connector=new v(this.options):this.options.broadcaster=="null"?this.connector=new y(this.options):typeof this.options.broadcaster=="function"&&(this.connector=new this.options.broadcaster(this.options))}},{key:"disconnect",value:function disconnect(){this.connector.disconnect()}},{key:"join",value:function join(e){return this.connector.presenceChannel(e)}},{key:"leave",value:function leave(e){this.connector.leave(e)}},{key:"leaveChannel",value:function leaveChannel(e){this.connector.leaveChannel(e)}},{key:"leaveAllChannels",value:function leaveAllChannels(){for(var e in this.connector.channels)this.leaveChannel(e)}},{key:"listen",value:function listen(e,n,t){return this.connector.listen(e,n,t)}},{key:"private",value:function _private(e){return this.connector.privateChannel(e)}},{key:"encryptedPrivate",value:function encryptedPrivate(e){return this.connector.encryptedPrivateChannel(e)}},{key:"socketId",value:function socketId(){return this.connector.socketId()}},{key:"registerInterceptors",value:function registerInterceptors(){typeof Vue==="function"&&Vue.http&&this.registerVueRequestInterceptor();typeof axios==="function"&&this.registerAxiosRequestInterceptor();typeof jQuery==="function"&&this.registerjQueryAjaxSetup();(typeof Turbo==="undefined"?"undefined":_typeof(Turbo))==="object"&&this.registerTurboRequestInterceptor()}},{key:"registerVueRequestInterceptor",value:function registerVueRequestInterceptor(){var e=this;Vue.http.interceptors.push((function(n,t){e.socketId()&&n.headers.set("X-Socket-ID",e.socketId());t()}))}},{key:"registerAxiosRequestInterceptor",value:function registerAxiosRequestInterceptor(){var e=this;axios.interceptors.request.use((function(n){e.socketId()&&(n.headers["X-Socket-Id"]=e.socketId());return n}))}},{key:"registerjQueryAjaxSetup",value:function registerjQueryAjaxSetup(){var e=this;typeof jQuery.ajax!="undefined"&&jQuery.ajaxPrefilter((function(n,t,r){e.socketId()&&r.setRequestHeader("X-Socket-Id",e.socketId())}))}},{key:"registerTurboRequestInterceptor",value:function registerTurboRequestInterceptor(){var e=this;document.addEventListener("turbo:before-fetch-request",(function(n){n.detail.fetchOptions.headers["X-Socket-Id"]=e.socketId()}))}}]);return Echo}();export{e as Channel,p as Connector,n as EventFormatter,k as default};

